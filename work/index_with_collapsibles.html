<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Ki ez - művészettörténeti társasjáték</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, sans-serif; margin: 2rem; line-height: 1.5; }
    img { max-width: 100%; height: auto; display: block; margin-top: 1rem; border-radius: 8px; }
    .note { color: #666; margin-bottom: 1rem; }
    code { background: color-mix(in srgb, CanvasText 10%, Canvas 90%); padding: 0.1rem 0.3rem; border-radius: 4px; }
    .controls { display: flex; gap: .5rem; flex-wrap: wrap; align-items: center; margin: 1rem 0; }
    .controls input[type="text"] {
      min-width: 18rem; padding: .5rem .6rem; border: 1px solid #ccc; border-radius: 6px;
    }
    .controls button {
      padding: .5rem .8rem; border: 1px solid #888; border-radius: 6px; background: #f4f4f4; cursor: pointer;
    }
    .controls button:hover { filter: brightness(0.97); }
    .row { margin-top: .5rem; color: #555; }
    .error { color: #b00020; }
    label { font-weight: 600; }
  </style>
</head>
<body>

  <!-- The image -->
  <img id="hero" src="" alt="">

  <script>
    (function () {
      // ── Configuration ───────────────────────────────────────────────────────────
      // Default image when no URL param is provided:
      const DEFAULT_IMAGE = 'img/31_0.png';
      // Default extension appended when only a basename is given:
      const DEFAULT_EXT = 'png'; // change to 'png' or 'svg' if you prefer
      // Allowed extensions:
      const ALLOWED_EXTS = ['jpg', 'jpeg', 'png', 'webp', 'gif', 'svg'];

      // ── Elements ───────────────────────────────────────────────────────────────
      const imgEl = document.getElementById('hero');
      const inputEl = document.getElementById('imgInput');
      const loadBtn = document.getElementById('loadBtn');
      const resetBtn = document.getElementById('resetBtn');
      const statusEl = document.getElementById('status');

      // ── Utilities ──────────────────────────────────────────────────────────────
      function getParamFromQuery(name) {
        return new URLSearchParams(window.location.search).get(name);
      }
      function getParamFromHash(name) {
        const hash = window.location.hash || '';
        if (!hash) return null;
        const params = new URLSearchParams(hash.replace(/^#/, ''));
        return params.get(name);
      }
      function setQueryParam(name, value) {
        const url = new URL(window.location.href);
        if (value == null || value === '') {
          url.searchParams.delete(name);
        } else {
          url.searchParams.set(name, value);
        }
        // Clear hash to keep the source of truth in query
        url.hash = '';
        history.replaceState(null, '', url.toString());
      }
      function sanitizePath(p) {
        if (typeof p !== 'string') return null;
        const trimmed = p.trim();
        if (!trimmed || trimmed.startsWith('http') || trimmed.includes('..')) return null;
        return trimmed.replace(/\\/g, '/');
      }
      function hasKnownExtension(path) {
        const m = path.toLowerCase().match(/\.([a-z0-9]+)$/);
        if (!m) return false;
        return ALLOWED_EXTS.includes(m[1]);
      }
      function ensureExtension(path, defaultExt) {
        if (hasKnownExtension(path)) return path;
        const ext = String(defaultExt || '').toLowerCase();
        if (!ALLOWED_EXTS.includes(ext)) return path; // if invalid config, don't append
        return `${path}.${ext}`;
      }
      function getRequestedImage() {
        // Prefer query param (?img=...), fall back to hash (#img=...)
        const q = getParamFromQuery('png');
        const h = getParamFromHash('png');
        return q ?? h ?? null;
      }
      function applyImage(srcPath) {
        imgEl.src = srcPath;
        imgEl.alt = srcPath.split('/').pop() || srcPath;
        statusEl.textContent = `Showing: ${srcPath}`;
        statusEl.classList.remove('error');
      }
      function showError(msg) {
        statusEl.textContent = msg;
        statusEl.classList.add('error');
      }

      // Central logic to pick and show an image based on URL state
      function pickAndApply() {
        let requested = getRequestedImage();
        if (requested) requested = sanitizePath(requested);

        if (!requested) {
          applyImage(DEFAULT_IMAGE);
          inputEl.value = ''; // clear UI input on default
          return;
        }

        const finalPath = ensureExtension(requested, DEFAULT_EXT);
        applyImage(finalPath);

        // Update input with the user's requested text (without extension if they didn't provide one)
        inputEl.value = requested;
        // Normalize URL to keep the basename (no extension) in the query if no explicit ext was used
        if (!hasKnownExtension(requested)) {
          setQueryParam('png', requested);
        } else {
          setQueryParam('png', requested); // preserve exact user choice
        }
      }

      // ── Event handlers ─────────────────────────────────────────────────────────
      // Load button: builds final path and applies, also updates URL
      loadBtn.addEventListener('click', () => {
        const raw = inputEl.value;
        const safe = sanitizePath(raw);
        if (!safe) {
          showError('Please enter a relative path like "img/5" or "img/5.png" (no http/..).');
          return;
        }
        const finalPath = ensureExtension(safe, DEFAULT_EXT);
        applyImage(finalPath);

        // Keep URL param in "basename" form if no extension was typed; otherwise keep what user typed
        const urlValue = hasKnownExtension(safe) ? safe : safe; // (same value here)
        setQueryParam('png', urlValue);
      });

      // Enter key triggers Load
      inputEl.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          loadBtn.click();
        }
      });

      // Reset button: clear to default and clean URL
      resetBtn.addEventListener('click', () => {
        applyImage(DEFAULT_IMAGE);
        inputEl.value = '';
        setQueryParam('png', null);
      });

      // Update if the hash changes (e.g., xy.html#img=img/b)
      window.addEventListener('hashchange', pickAndApply);

      // Initial load
      pickAndApply();
    })();
  </script>
</body>
</html>

<!-- Link examples:

xy.html#img=images/5
xy.html?img=images/13 -->

<!--
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
.collapsible {
  background-color: #777;
  color: white;
  cursor: pointer;
  padding: 18px;
  width: 100%;
  border: none;
  text-align: left;
  outline: none;
  font-size: 15px;
}

.active, .collapsible:hover {
  background-color: #555;
}

.content {
  padding: 0 18px;
  display: none;
  overflow: hidden;
  background-color: #f1f1f1;
}
</style>
</head>
<body>

<h2>Collapsibles</h2>

<p>Collapsible Set:</p>
<button type="button" class="collapsible">Open Section 1</button>
<div class="content">
  <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
</div>
<button type="button" class="collapsible">Open Section 2</button>
<div class="content">
  <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
</div>
<button type="button" class="collapsible">Open Section 3</button>
<div class="content">
  <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
</div>

<script>
var coll = document.getElementsByClassName("collapsible");
var i;

for (i = 0; i < coll.length; i++) {
  coll[i].addEventListener("click", function() {
    this.classList.toggle("active");
    var content = this.nextElementSibling;
    if (content.style.display === "block") {
      content.style.display = "none";
    } else {
      content.style.display = "block";
    }
  });
}
</script>

</body>
</html>

-->
